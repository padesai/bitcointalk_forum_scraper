# -*- coding: utf-8 -*-
from bs4 import BeautifulSoup
import datetime

test_comment1 = u"<td class=\"windowbg\">\n\t\t\t\t<table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" style=\"table-layout: fixed;\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td valign=\"top\" width=\"16%\" rowspan=\"2\" style=\"overflow: hidden;\" class=\"poster_info\">\n\t\t\t\t\t\t\t<b><a href=\"https://bitcointalk.org/index.php?action=profile;u=154599\" title=\"View the profile of lnternet\">lnternet</a></b>\n\t\t\t\t\t\t\t<div class=\"smalltext\">\n\t\t\t\t\t\t\t\tSr. Member<br>\n\t\t\t\t\t\t\t\t<img src=\"https://bitcointalk.org/Themes/custom1/images/star.gif\" alt=\"*\" border=\"0\"><img src=\"https://bitcointalk.org/Themes/custom1/images/star.gif\" alt=\"*\" border=\"0\"><img src=\"https://bitcointalk.org/Themes/custom1/images/star.gif\" alt=\"*\" border=\"0\"><img src=\"https://bitcointalk.org/Themes/custom1/images/star.gif\" alt=\"*\" border=\"0\"><br>\n\t\t\t\t\t\t\t\t<img src=\"https://bitcointalk.org/Themes/custom1/images/useroff.gif\" alt=\"Offline\" border=\"0\" style=\"margin-top: 2px;\"><span class=\"smalltext\"> Offline</span><br><br>\n\t\t\t\t\t\t\t\tActivity: 291<br><br>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<a href=\"https://bitcointalk.org/index.php?action=profile;u=154599\"><img src=\"https://bitcointalk.org/Themes/custom1/images/icons/profile_sm.gif\" alt=\"View Profile\" title=\"View Profile\" border=\"0\"></a><br>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td valign=\"top\" width=\"85%\" height=\"100%\" style=\"padding: 2px;\" class=\"td_headerandpost\">\n\t\t\t\t\t\t\t<table width=\"100%\" border=\"0\"><tr>\n\t\t\t\t\t\t\t\t<td valign=\"middle\"><a href=\"https://bitcointalk.org/index.php?topic=459845.msg5124934#msg5124934\"><img src=\"https://bitcointalk.org/Themes/custom1/images/post/xx.gif\" alt=\"\" border=\"0\"></a></td>\n\t\t\t\t\t\t\t\t<td valign=\"middle\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div style=\"font-weight: bold;\" class=\"subject\" id=\"subject_5124934\">\n\t\t\t\t\t\t\t\t\t\t<a href=\"https://bitcointalk.org/index.php?topic=459845.msg5124934#msg5124934\">Re: 2 mysterious satoshi transfers from addresses enjoy, sochi. </a>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"smalltext\">February 13, 2014, 07:06:12 PM</div></td>\n\t\t\t\t\t\t\t\t\t\t  <td align=\"right\" valign=\"middle\" height=\"20\" style=\"font-size: smaller; padding-top: 4px;\" class=\"td_buttons\"><div id=\"ignmsgbttns37\" style=\"visibility: visible;\">  <a class=\"message_number\" style=\"vertical-align: middle;\" href=\"https://bitcointalk.org/index.php?topic=459845.msg5124934#msg5124934\">#37</a>\n\t\t </div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr></table>\n\t\t\t\t\t\t\t\t\t <hr width=\"100%\" size=\"1\" class=\"hrcolor\" style=\"margin-top: 4px;\">\n\t\t\t\t\t\t\t<div class=\"post\">I think the software already deals with this, every node only keeps a limited list of pending transactions, and kicks out the ones with lowest priority if the list is full<br><br>Some dev explanation how this works exactly would be appreciated.</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td valign=\"bottom\" class=\"smalltext\" width=\"85%\">\n\t\t\t\t\t\t\t<table width=\"100%\" border=\"0\" style=\"table-layout: fixed;\"><tr>\n\t\t\t\t\t\t\t\t<td colspan=\"2\" class=\"smalltext\" width=\"100%\">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr><tr>\n\t\t\t\t\t\t\t\t<td valign=\"bottom\" class=\"smalltext\" id=\"modified_5124934\">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td align=\"right\" valign=\"bottom\" class=\"smalltext\">\n\t\t\t\t\t\t\t\t\t<img src=\"https://bitcointalk.org/Themes/custom1/images/ip.gif\" alt=\"\" border=\"0\">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr></table>\n\t\t\t\t\t\t\t<hr width=\"100%\" size=\"1\" class=\"hrcolor\">\n\t\t\t\t\t\t\t<div class=\"signature sig154599\"><span style=\"font-family: Arial;\"><span style=\"color: black;\"><span style=\"font-size: 7pt !important; line-height: 1.3em;\"><b>1ntemetqbXokPSSkuHH4iuAJRTQMP6uJ9</b></span></span></span></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</td>"
test_comment2 = u"<td class=\"windowbg\">\n\t\t\t\t<table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" style=\"table-layout: fixed;\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td valign=\"top\" width=\"16%\" rowspan=\"2\" style=\"overflow: hidden;\" class=\"poster_info\">\n\t\t\t\t\t\t\t<b><a href=\"https://bitcointalk.org/index.php?action=profile;u=5122\" title=\"View the profile of joepie91\">joepie91</a></b>\n\t\t\t\t\t\t\t<div class=\"smalltext\">\n\t\t\t\t\t\t\t\tSr. Member<br>\n\t\t\t\t\t\t\t\t<img src=\"https://bitcointalk.org/Themes/custom1/images/star.gif\" alt=\"*\" border=\"0\"><img src=\"https://bitcointalk.org/Themes/custom1/images/star.gif\" alt=\"*\" border=\"0\"><img src=\"https://bitcointalk.org/Themes/custom1/images/star.gif\" alt=\"*\" border=\"0\"><img src=\"https://bitcointalk.org/Themes/custom1/images/star.gif\" alt=\"*\" border=\"0\"><br>\n\t\t\t\t\t\t\t\t<img src=\"https://bitcointalk.org/Themes/custom1/images/useroff.gif\" alt=\"Offline\" border=\"0\" style=\"margin-top: 2px;\"><span class=\"smalltext\"> Offline</span><br><br>\n\t\t\t\t\t\t\t\tActivity: 294<br><br>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<a href=\"https://bitcointalk.org/index.php?action=profile;u=5122\"><img src=\"https://bitcointalk.org/Themes/custom1/images/icons/profile_sm.gif\" alt=\"View Profile\" title=\"View Profile\" border=\"0\"></a><br>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td valign=\"top\" width=\"85%\" height=\"100%\" style=\"padding: 2px;\" class=\"td_headerandpost\">\n\t\t\t\t\t\t\t<table width=\"100%\" border=\"0\"><tr>\n\t\t\t\t\t\t\t\t<td valign=\"middle\"><a href=\"https://bitcointalk.org/index.php?topic=23068.msg322553#msg322553\"><img src=\"https://bitcointalk.org/Themes/custom1/images/post/xx.gif\" alt=\"\" border=\"0\"></a></td>\n\t\t\t\t\t\t\t\t<td valign=\"middle\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div style=\"font-weight: bold;\" class=\"subject\" id=\"subject_322553\">\n\t\t\t\t\t\t\t\t\t\t<a href=\"https://bitcointalk.org/index.php?topic=23068.msg322553#msg322553\">Re: ALL of my bitcoins stolen (Around 60) . What the F*CK.</a>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"smalltext\">July 04, 2011, 02:04:01 PM</div></td>\n\t\t\t\t\t\t\t\t\t\t  <td align=\"right\" valign=\"middle\" height=\"20\" style=\"font-size: smaller; padding-top: 4px;\" class=\"td_buttons\"><div id=\"ignmsgbttns111\" style=\"visibility: visible;\">  <a class=\"message_number\" style=\"vertical-align: middle;\" href=\"https://bitcointalk.org/index.php?topic=23068.msg322553#msg322553\">#111</a>\n\t\t </div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr></table>\n\t\t\t\t\t\t\t\t\t <hr width=\"100%\" size=\"1\" class=\"hrcolor\" style=\"margin-top: 4px;\">\n\t\t\t\t\t\t\t<div class=\"post\"><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=23068.msg294796#msg294796\">Quote from: synergy543 on June 28, 2011, 01:37:06 AM</a></div><div class=\"quote\"><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=23068.msg294554#msg294554\">Quote from: joepie91 on June 28, 2011, 12:21:14 AM</a></div><div class=\"quote\">You can only use a password to protect (= encrypt) the private keys. Once someone has those keys he can do what he wants.<br></div>Yes, exactly my point.  It seems the system would be greatly improved if the sender had the ability to \"verify\" a transaction.  Thus, my money could only be used by me (when I verify it) and then it becomes yours.<br><br>Such a system would make the Bitcoin extremely attractive!<br></div>That's not technically possible. That is what your private key does - it authorizes a transaction. You can put a transaction password on your client, but that doesn't do anything if someone steals your wallet.dat - because they can just use the wallet.dat in a client that does not have that protection. If you have the private keys, you can spend the bitcoins, and there is to the best of my knowledge no technically possible way to prevent that.</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td valign=\"bottom\" class=\"smalltext\" width=\"85%\">\n\t\t\t\t\t\t\t<table width=\"100%\" border=\"0\" style=\"table-layout: fixed;\"><tr>\n\t\t\t\t\t\t\t\t<td colspan=\"2\" class=\"smalltext\" width=\"100%\">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr><tr>\n\t\t\t\t\t\t\t\t<td valign=\"bottom\" class=\"smalltext\" id=\"modified_322553\">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td align=\"right\" valign=\"bottom\" class=\"smalltext\">\n\t\t\t\t\t\t\t\t\t<img src=\"https://bitcointalk.org/Themes/custom1/images/ip.gif\" alt=\"\" border=\"0\">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr></table>\n\t\t\t\t\t\t\t<hr width=\"100%\" size=\"1\" class=\"hrcolor\">\n\t\t\t\t\t\t\t<div class=\"signature sig5122\">Like my post(s)? 12TSXLa5Tu6ag4PNYCwKKSiZsaSCpAjzpu <img src=\"https://bitcointalk.org/Smileys/default/smiley.gif\" alt=\"Smiley\" border=\"0\"><br><div class=\"quoteheader\">Quote from: hawks5999</div><div class=\"quote\">I just can't wait for fall/winter. My furnace never generated money for me before. I'll keep mining until my furnace is more profitable. <br></div></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</td>"


def parse_comment(comment):
    # Tries to parse a stored comment from the web crawler
    soup = BeautifulSoup(comment, "html.parser")
    try:
        profile_url = soup.a['href']
        username = soup.a.get_text()
    except:
        profile_url = "Failed_to_parse_profile_url"
        username = "Failed_to_parse_the_username"

    try:
        # post = soup.find_all("div", class_="post")[0].get_text()
        post = soup.find_all("div", class_="post")[0]
    except:
        post = ""

    try:
        # signature = soup.find_all("div", class_="signature")[0].get_text()
        signature = soup.find_all("div", class_="signature")[0]

    except:
        signature = ""

    small_text = soup.find_all("div", class_="smalltext")
    post_date = ""
    for div in small_text:
        try:
            post_date = datetime.datetime.strptime(div.get_text(), "%B %d, %Y, %I:%M:%S %p")
        except:
            pass

    output = {"comment": {"post": str(post), "signature": str(signature)}, "date": str(post_date), "username": username,
              "profile_url": str(profile_url)}

    return output


if __name__ == "__main__":
    # print parse_comment(test_comment2)
    pass
